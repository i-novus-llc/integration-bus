<?xml version='1.0' encoding='UTF-8'?>
<object xmlns="http://n2oapp.net/framework/config/schema/object-3.0" name="registry">
    <operations>
        <operation id="createParticipant">
            <invocation>
                <rest method="POST">/participants</rest>
            </invocation>
            <in-parameters>
                <param id="id" mapping="['code']" domain="string" required="true"/>
                <param id="name" mapping="['name']" domain="string" required="true"/>
                <param id="disable" mapping="['disable']" domain="boolean" default-value="false"/>
            </in-parameters>
        </operation>

        <operation id="updateParticipant">
            <invocation>
                <rest method="PUT">/participants</rest>
            </invocation>
            <in-parameters>
                <param id="id" mapping="['code']" domain="string" required="true"/>
                <param id="name" mapping="['name']" domain="string" required="true"/>
                <param id="disable" mapping="['disable']" domain="boolean" default-value="false"/>
            </in-parameters>
        </operation>

        <operation id="deleteParticipant" confirm="true" confirm-text="Вы уверены, что хотите удалить участника?"
                   success-text="Участник удален">
            <invocation>
                <rest method="DELETE">/participants/{code}</rest>
            </invocation>
            <in-parameters>
                <param id="id" mapping="['code']" domain="string"/>
            </in-parameters>
        </operation>

        <operation id="createMethod">
            <invocation>
                <sql>
                    INSERT INTO integration.participant_method(
                    id, participant_code, method_code, url, disable)
                    VALUES (nextval('integration.participant_method_id_seq'), :participant_code, :method_code, :url,
                    :disable);
                </sql>
            </invocation>
            <in-parameters>
                <param id="participant_code" mapping="['participant_code']" domain="string"/>
                <param id="method_code" mapping="['method_code']" domain="string"/>
                <param id="url" mapping="['url']" domain="string"/>
                <param id="disable" mapping="['disable']" domain="boolean"/>
            </in-parameters>
        </operation>

        <operation id="updateMethod">
            <invocation>
                <sql>
                    UPDATE integration.participant_method
                    SET method_code=:method_code, url=:url, disable=:disable
                    WHERE id=:id;
                </sql>
            </invocation>
            <in-parameters>
                <param id="id" mapping="['id']" domain="integer"/>
                <param id="method_code" mapping="['method_code']" domain="string"/>
                <param id="url" mapping="['url']" domain="string"/>
                <param id="disable" mapping="['disable']" domain="boolean"/>
            </in-parameters>
        </operation>

        <operation id="deleteMethod" confirm="true">
            <invocation>
                <sql>
                    DELETE FROM integration.participant_method
                    WHERE id=:id;
                </sql>
            </invocation>
            <in-parameters>
                <param id="id" mapping="['id']" domain="integer"/>
            </in-parameters>
        </operation>

        <operation id="permissionCreate">
            <invocation>
                <sql>
                    INSERT INTO integration.participant_permission(
                    id, participant_method_id, participant_code, group_code, callback_url,
                    sync)
                    VALUES (nextval('integration.participant_permission_id_seq'),
                    :participant_method_id, :participant, :group_code, :callback_url, :sync);
                </sql>
            </invocation>
            <in-parameters>
                <param id="participant_method_id" mapping="['participant_method_id']" domain="integer"/>
                <param id="participant" mapping="['participant']" normalize="['id']" domain="string"/>
                <param id="group_code" mapping="['group_code']" domain="string"/>
                <param id="callback_url" mapping="['callback_url']" domain="string"/>
                <param id="sync" mapping="['sync']" domain="boolean"/>
            </in-parameters>
        </operation>

        <operation id="permissionUpdate">
            <invocation>
                <sql>
                    UPDATE integration.participant_permission
                    SET participant_code=:participant, group_code=:group_code,
                    callback_url=:callback_url, sync=:sync
                    WHERE id=:id;
                </sql>
            </invocation>
            <in-parameters>
                <param id="id" mapping="['id']" domain="integer"/>
                <param id="participant" mapping="['participant']" normalize="['id']" domain="string"/>
                <param id="group_code" mapping="['group_code']" domain="string"/>
                <param id="callback_url" mapping="['callback_url']" domain="string"/>
                <param id="sync" mapping="['sync']" domain="boolean"/>
            </in-parameters>
        </operation>

        <operation id="permissionDelete" confirm="true">
            <invocation>
                <sql>
                    DELETE FROM integration.participant_permission
                    WHERE id=:id;
                </sql>
            </invocation>
            <in-parameters>
                <param id="id" mapping="['id']" domain="integer"/>
            </in-parameters>
        </operation>
    </operations>
</object>
